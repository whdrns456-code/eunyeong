<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì›ê°€ì… - íë§ í”„ë¦¬ë¯¸ì—„ ì‹¤ë²„ì¼€ì–´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #FDFCFB; /* Off-white */
            color: #1c1917;
        }
        .input-focus:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
            outline: none;
        }
        .strength-bar {
            height: 6px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            width: 0%;
            border-radius: 999px;
        }
        .reveal-node {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }
        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }
        /* Hidden verification section */
        #verificationArea {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, opacity 0.4s ease;
            opacity: 0;
        }
        #verificationArea.visible {
            max-height: 200px;
            opacity: 1;
            margin-top: 1rem;
        }
    </style>

    <link rel="stylesheet" href="/index.css">
</head>
<header th:replace="~{header/header :: mainHeader}"></header>
<body class="min-h-screen flex items-center justify-center p-4 sm:p-8 md:p-12 lg:p-20">

<!-- íšŒì›ê°€ì… ì¹´ë“œ ì»¨í…Œì´ë„ˆ -->
<div class="w-full max-w-[520px] bg-white rounded-[2.5rem] shadow-[0_30px_60px_rgba(30,58,138,0.08)] p-8 sm:p-12 reveal-node border border-blue-50/50">

    <!-- ë¡œê³  ë° í—¤ë” -->
    <div class="text-center mb-10">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-3xl shadow-xl shadow-blue-200/50 mb-6 transition-transform hover:scale-110">
            <i data-lucide="user-plus" class="text-white w-8 h-8"></i>
        </div>
        <h1 class="text-3xl font-bold text-stone-900 tracking-tight">íšŒì›ê°€ì…</h1>
        <p class="text-stone-500 text-sm mt-3 font-light">ì–´ë¥´ì‹ ê³¼ ê°€ì¡±ì„ ìœ„í•œ íŠ¹ë³„í•œ ì‹œì‘ì„ í•¨ê»˜í•˜ì„¸ìš”.</p>
    </div>

    <form id="registerForm" class="space-y-6">
        <!-- ì•„ì´ë”” -->
        <div class="space-y-2.5">
            <label class="block text-sm font-bold text-stone-700 ml-1">ì•„ì´ë””</label>
            <div class="flex flex-col sm:flex-row gap-2.5">
                <input type="text" id="userId" name="userId" placeholder="ì•„ì´ë””" required
                       class="flex-1 px-5 py-4 bg-stone-50/80 border border-stone-200 rounded-2xl text-sm input-focus transition-all">
                <button type="button" onclick="checkDuplicateId()"
                        class="px-6 py-4 bg-blue-50 text-blue-700 font-bold rounded-2xl text-xs hover:bg-blue-100 transition-all border border-blue-100 whitespace-nowrap active:scale-95">
                    ì¤‘ë³µ í™•ì¸
                </button>
            </div>
            <p id="idMsg" class="text-[11px] ml-1 min-h-[1rem]"></p>
        </div>

        <!-- ì´ë¦„ -->
        <div class="space-y-2.5">
            <label class="block text-sm font-bold text-stone-700 ml-1">ì´ë¦„</label>
            <input type="text" id="userName" name="userName" placeholder="ì‹¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required
                   class="w-full px-5 py-4 bg-stone-50/80 border border-stone-200 rounded-2xl text-sm input-focus transition-all">
        </div>

        <!-- ë¹„ë°€ë²ˆí˜¸ -->
        <div class="space-y-2.5">
            <label class="block text-sm font-bold text-stone-700 ml-1">ë¹„ë°€ë²ˆí˜¸ <span class="font-normal text-stone-400 text-xs">(8~11ì)</span></label>
            <input type="password" id="userPw" name="userPw" placeholder="ì˜ë¬¸/ìˆ«ì/íŠ¹ìˆ˜ë¬¸ì ì¡°í•©" required maxlength="11"
                   class="w-full px-5 py-4 bg-stone-50/80 border border-stone-200 rounded-2xl text-sm input-focus transition-all">

            <div class="px-1 pt-1">
                <div class="w-full bg-stone-100 rounded-full h-1.5 overflow-hidden">
                    <div id="strengthBar" class="strength-bar bg-stone-300"></div>
                </div>
                <div class="flex justify-between items-center text-[10px] font-bold mt-2">
                    <span id="strengthText" class="text-stone-400">ë³´ì•ˆ ë“±ê¸‰ ëŒ€ê¸°</span>
                    <span id="pwLength" class="text-stone-400">0/11</span>
                </div>
            </div>
        </div>

        <!-- ë¹„ë°€ë²ˆí˜¸ í™•ì¸ -->
        <div class="space-y-2.5">
            <label class="block text-sm font-bold text-stone-700 ml-1">ë¹„ë°€ë²ˆí˜¸ ì¬í™•ì¸</label>
            <input type="password" id="userPwConfirm" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" required
                   class="w-full px-5 py-4 bg-stone-50/80 border border-stone-200 rounded-2xl text-sm input-focus transition-all">
            <p id="pwMatchMsg" class="text-[11px] ml-1 min-h-[1rem]"></p>
        </div>

        <!-- ì´ë©”ì¼ ë° ì¸ì¦ë²ˆí˜¸ -->
        <div class="space-y-2.5">
            <label class="block text-sm font-bold text-stone-700 ml-1">ì´ë©”ì¼ ì¸ì¦</label>
            <div class="flex flex-col sm:flex-row gap-2.5">
                <input type="email" id="userEmail" name="userEmail" placeholder="example@care.com" required
                       class="flex-1 px-5 py-4 bg-stone-50/80 border border-stone-200 rounded-2xl text-sm input-focus transition-all">
                <button type="button" id="sendEmailBtn" onclick="requestVerification()"
                        class="px-6 py-4 bg-stone-900 text-white font-bold rounded-2xl text-xs hover:bg-blue-600 transition-all shadow-lg active:scale-95">
                    ì¸ì¦ ìš”ì²­
                </button>
            </div>

            <!-- ì¸ì¦ë²ˆí˜¸ ì…ë ¥ ì¹¸ (ì¸ì¦ ìš”ì²­ í›„ ë“±ì¥) -->
            <div id="verificationArea" class="space-y-2.5">
                <div class="flex flex-col sm:flex-row gap-2.5">
                    <input type="text" id="verificationCode" placeholder="ì¸ì¦ë²ˆí˜¸ 6ìë¦¬" maxlength="6"
                           class="flex-1 px-5 py-4 bg-blue-50/50 border border-blue-200 rounded-2xl text-sm input-focus transition-all font-mono tracking-widest text-center">
                    <button type="button" onclick="verifyCode()"
                            class="px-6 py-4 bg-blue-600 text-white font-bold rounded-2xl text-xs hover:bg-blue-700 transition-all active:scale-95 shadow-md shadow-blue-100">
                        ë²ˆí˜¸ í™•ì¸
                    </button>
                </div>
                <p id="verifyMsg" class="text-[11px] ml-1 min-h-[1rem]"></p>
            </div>
        </div>

        <!-- ì•½ê´€ ë™ì˜ -->
        <div class="pt-4">
            <div class="flex items-start gap-4 p-5 bg-blue-50/30 rounded-3xl border border-blue-100/50 hover:bg-blue-50 transition-colors">
                <input type="checkbox" id="agreeCheck" required
                       class="w-5 h-5 mt-1 rounded border-stone-300 text-blue-600 focus:ring-blue-500 cursor-pointer">
                <label for="agreeCheck" class="text-xs text-stone-600 cursor-pointer leading-relaxed">
                    <span class="font-bold text-blue-700">[í•„ìˆ˜]</span> ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© í†µì‹  ì²´í¬ ë°•ìŠ¤. ë™ì˜í•˜ì§€ ì•Šì„ ê²½ìš° íšŒì›ê°€ì…ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
                </label>
            </div>
        </div>

        <!-- ìµœì¢… ê°€ì… ë²„íŠ¼ -->
        <button type="submit" id="submitBtn"
                class="w-full py-5 bg-blue-600 text-white font-black rounded-2xl hover:bg-blue-700 transition-all shadow-2xl shadow-blue-200 mt-6 active:scale-95 flex items-center justify-center gap-2">
            ê°€ì…í•˜ê¸° <i data-lucide="check" class="w-5 h-5"></i>
        </button>
    </form>

    <p class="text-center text-xs text-stone-400 mt-10">ê³„ì •ì´ ì´ë¯¸ ìˆìœ¼ì‹ ê°€ìš”? <a href="./login" class="text-blue-600 font-bold hover:underline">ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ</a></p>
</div>

<!-- Hidden element for React-Free build compatibility -->
<div id="root" style="display: none;"></div>

<script>
    lucide.createIcons();

    // ìƒíƒœ ê´€ë¦¬ ë³€ìˆ˜
    let isIdValid = false;
    let isEmailVerified = false;
    let serverAuthCode = ""; // ì„œë²„ì—ì„œ ë°›ì€ ì¸ì¦ë²ˆí˜¸ ì €ì¥ìš©

    // DOM ìš”ì†Œ ì°¸ì¡°
    const idInput = document.getElementById('userId');
    const idMsg = document.getElementById('idMsg');
    const pwInput = document.getElementById('userPw');
    const strengthBar = document.getElementById('strengthBar');
    const strengthText = document.getElementById('strengthText');
    const pwLengthText = document.getElementById('pwLength');
    const pwConfirm = document.getElementById('userPwConfirm');
    const pwMatchMsg = document.getElementById('pwMatchMsg');
    const verifyArea = document.getElementById('verificationArea');
    const verifyMsg = document.getElementById('verifyMsg');
    const sendEmailBtn = document.getElementById('sendEmailBtn');
    const submitBtn = document.getElementById('submitBtn');

    // [Async] ì•„ì´ë”” ì¤‘ë³µ ê²€ì¦ (ì‹¤ì œ ì„œë²„ ì—°ë™ ì‹œ fetchë¡œ ë³€ê²½ í•„ìš”)
    async function checkDuplicateId() {
        const id = idInput.value;
        // ì˜ë¬¸ê³¼ ìˆ«ìê°€ ë°˜ë“œ ì‹œ í•˜ë‚˜ ì´ìƒ í¬í•¨ë˜ê²Œ
        const idRegex = /^(?=.*[a-z])(?=.*[0-9])[a-z0-9]{8,12}$/;

        if (!id) {
            alert('ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        if (!idRegex.test(id)) {
            idMsg.textContent = '8~12ìì˜ ì˜ë¬¸ ì†Œë¬¸ìì™€ ìˆ«ìë¥¼ í˜¼í•©í•´ì„œ ì…ë ¥í•´ì£¼ì„¸ìš”.';
            idMsg.className = 'text-[11px] ml-1 text-rose-500 font-bold';
            return;
        }


        idMsg.textContent = 'ì¡°íšŒ ì¤‘...';
        idMsg.className = 'text-[11px] ml-1 text-stone-400';

        try {
            const response = await fetch('/api/member/checkId', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ userId: id })
            });


            const data = await response.text();
            const isDuplicated = (data === 'true');


            if(isDuplicated) {
                idMsg.textContent = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                idMsg.className = 'text-[11px] ml-1 text-rose-500 font-bold';
                isIdValid = false;
            } else {
                idMsg.textContent = 'ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                idMsg.className = 'text-[11px] ml-1 text-blue-600 font-bold';
                isIdValid = true;
               }
        } catch(e) {
            idMsg.textContent = 'ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            alert(e);
        }
    }

    // ë¹„ë°€ë²ˆí˜¸ ë³´ì•ˆ ë“±ê¸‰ ì‹¤ì‹œê°„ ì²´í¬
    pwInput.addEventListener('input', () => {
        const val = pwInput.value;
        const len = val.length;
        pwLengthText.textContent = `${len}/11`;

        // í•„ìˆ˜ ì¡°ê±´: ì˜ë¬¸ ì†Œë¬¸ìì™€ ìˆ«ìê°€ ë°˜ë“œì‹œ í¬í•¨ëœ 8~11ì
        const isBasicValid = /[a-z]/.test(val) && /[0-9]/.test(val);

        let score = 0;
        if (len >= 8) {
            // í•„ìˆ˜ ìš”ì†Œ (ì ìˆ˜ ë°˜ì˜)
            if (/[a-z]/.test(val)) score++;
            if (/[0-9]/.test(val)) score++;

            // ì„ íƒ ìš”ì†Œ (ì¶”ê°€ ì ìˆ˜)
            if (/[A-Z]/.test(val)) score++;
            if (/[^A-Za-z0-9]/.test(val)) score++;
        }

        const grades = [
            { t: 'ìµœì†Œ 8ì ì´ìƒ ì…ë ¥', c: 'bg-stone-200', tc: 'text-stone-400', w: '10%' },
            { t: 'ì¡°ê±´ ë¯¸ë‹¬ (ì˜ë¬¸ ì†Œë¬¸ì/ìˆ«ì ì¡°í•© í•„ìˆ˜)', c: 'bg-rose-500', tc: 'text-rose-500', w: '30%' },
            { t: 'ë³´í†µ (í•„ìˆ˜ ì¡°ê±´ ì¶©ì¡±)', c: 'bg-amber-500', tc: 'text-amber-500', w: '60%' },
            { t: 'ì•ˆì „í•¨ (ëŒ€ë¬¸ì/íŠ¹ìˆ˜ë¬¸ì í¬í•¨)', c: 'bg-blue-600', tc: 'text-blue-600', w: '85%' },
            { t: 'ìµœìƒìœ„ ë³´ì•ˆ ë“±ê¸‰', c: 'bg-emerald-500', tc: 'text-emerald-500', w: '100%' }
        ];

        let current;
        if (len < 8) {
            current = grades[0];
        } else if (!isBasicValid) {
            current = grades[1];
        } else {
            // scoreê°€ 2(ì†Œë¬¸ì+ìˆ«ì)ì¼ ë•Œ grades[2]ê°€ ì¶œë ¥ë˜ë„ë¡ ë§¤ì¹­
            // ë§Œì•½ ëŒ€ë¬¸ì/íŠ¹ìˆ˜ë¬¸ìê¹Œì§€ ì¶”ê°€ë˜ë©´ scoreê°€ 3 ë˜ëŠ” 4ê°€ ë¨
            current = grades[score] || grades[2];
        }

        strengthBar.className = `strength-bar ${current.c}`;
        strengthBar.style.width = current.w;
        strengthText.textContent = `ë³´ì•ˆ ë“±ê¸‰: ${current.t}`;
        strengthText.className = `font-bold ${current.tc}`;

        validatePwMatch();
    });

    // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ê²€ì¦
    function validatePwMatch() {
        if(!pwConfirm.value) { pwMatchMsg.textContent = ''; return; }
        if(pwInput.value === pwConfirm.value) {
            pwMatchMsg.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.';
            pwMatchMsg.className = 'text-[11px] ml-1 text-blue-600 font-bold';
        } else {
            pwMatchMsg.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì„œë¡œ ë‹¤ë¦…ë‹ˆë‹¤.';
            pwMatchMsg.className = 'text-[11px] ml-1 text-rose-500 font-bold';
        }
    }
    pwConfirm.addEventListener('input', validatePwMatch);

    // [Async] ì´ë©”ì¼ ì¸ì¦ë²ˆí˜¸ ìš”ì²­
    async function requestVerification() {
        const email = document.getElementById('userEmail').value;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        if (!emailRegex.test(email)) {
            alert('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•˜ì„¸ìš”.');
            return;
        }

        const sendEmailBtn = document.getElementById('sendEmailBtn'); // ë³€ìˆ˜ ì„ ì–¸ í™•ì¸
        sendEmailBtn.disabled = true;
        sendEmailBtn.innerHTML = '<i data-lucide="loader-2" class="animate-spin w-4 h-4"></i> ê²€ì‚¬ ì¤‘...';
        if(window.lucide) lucide.createIcons();

        try {
            // 1. ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬
            const checkRes = await fetch('/api/member/checkEmail', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({userEmail: email})
            });

            const checkResult = await checkRes.text();
            const isDuplicated = (checkResult.trim() === 'true');

            if (isDuplicated) {
                alert('ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ ì£¼ì†Œì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì´ë©”ì¼ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
                sendEmailBtn.innerHTML = 'ì¸ì¦ ìš”ì²­';
                sendEmailBtn.disabled = false;
                return; // ì¤‘ë³µì´ë©´ ì—¬ê¸°ì„œ ì¢…ë£Œ
            }

            // 2. ì´ë©”ì¼ ë°œì†¡
            sendEmailBtn.innerHTML = '<i data-lucide="loader-2" class="animate-spin w-4 h-4"></i> ë°œì†¡ ì¤‘...';
            const response = await fetch(`/api/mail/mailTest?email=${encodeURIComponent(email)}`);

            if (response.ok) {
                serverAuthCode = (await response.text()).trim();
                alert('ì¸ì¦ë²ˆí˜¸ê°€ ì´ë©”ì¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                console.log('í…ŒìŠ¤íŠ¸ìš© í™•ì¸(ì„œë²„ì½”ë“œ):', serverAuthCode);

                document.getElementById('verificationArea').classList.add('visible');
                sendEmailBtn.innerHTML = 'ì¬ìš”ì²­';
            } else {
                throw new Error('ë°œì†¡ ì‹¤íŒ¨');
            }

        } catch (e) {
            alert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            console.error(e);
            sendEmailBtn.innerHTML = 'ì¸ì¦ ìš”ì²­';
        } finally {
            sendEmailBtn.disabled = false;
            if(window.lucide) lucide.createIcons();
        }
    } // <--- ì´ ë‹«ëŠ” ì¤‘ê´„í˜¸ê°€ ëª…í™•íˆ ìˆì–´ì•¼ í•©ë‹ˆë‹¤!

            // [Function] ì¸ì¦ë²ˆí˜¸ í™•ì¸
            function verifyCode() {
                const userInputCode = document.getElementById('verificationCode').value;

                if (!userInputCode) {
                    alert('ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                // ì„œë²„ì—ì„œ ë°›ì•„ë‘” ë²ˆí˜¸ì™€ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë²ˆí˜¸ ë¹„êµ
                if (userInputCode === serverAuthCode.trim()) {
                    isEmailVerified = true;
                    verifyMsg.textContent = 'ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
                    verifyMsg.className = 'text-[11px] ml-1 text-blue-600 font-bold';

                    document.getElementById('verificationCode').disabled = true;
                    document.getElementById('userEmail').readOnly = true;
                    alert('ì¸ì¦ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤.');
                } else {
                    isEmailVerified = false;
                    verifyMsg.textContent = 'ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                    verifyMsg.className = 'text-[11px] ml-1 text-rose-500 font-bold';
                    alert('ì¸ì¦ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
            }

            // [Async] ì „ì²´ í¼ ì œì¶œ (íšŒì›ê°€ì… ì²˜ë¦¬)
            document.getElementById('registerForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                // 1. ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì •ê·œì‹ ì •ì˜ (ì˜ë¬¸ ì†Œë¬¸ì + ìˆ«ì í•„ìˆ˜)
                const idRegex = /^(?=.*[a-z])(?=.*[0-9])[a-z0-9]{8,12}$/;
                const pwRegex = /^(?=.*[a-z])(?=.*[0-9]).{8,11}$/;

                // 2. ìµœì¢… ìœ íš¨ì„± ê²€ì‚¬ (ì„œë²„ ì „ì†¡ ì „ ë§ˆì§€ë§‰ ë°”ë¦¬ì¼€ì´ë“œ)
                if (!idRegex.test(idInput.value)) {
                    alert('ì•„ì´ë””ëŠ” 8~12ìì˜ ì˜ë¬¸ ì†Œë¬¸ìì™€ ìˆ«ìë¥¼ í˜¼í•©í•´ì•¼ í•©ë‹ˆë‹¤.');
                    idInput.focus();
                    return;
                }
                if (!isIdValid) {
                    alert('ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                    return;
                }

                if (!pwRegex.test(pwInput.value)) {
                    alert('ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ë¬¸ ì†Œë¬¸ìì™€ ìˆ«ìë¥¼ í¬í•¨í•˜ì—¬ 8~11ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    pwInput.focus();
                    return;
                }
                // ìµœì¢… ìœ íš¨ì„± ê²€ì‚¬
                if (!isIdValid) {
                    alert('ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (!isEmailVerified) {
                    alert('ì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                    return;
                }
                if (pwInput.value !== pwConfirm.value) {
                    alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    return;
                }
                if (pwInput.value.length < 8) {
                    alert('ë¹„ë°€ë²ˆí˜¸ê°€ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤.');
                    return;
                }
                if (!document.getElementById('agreeCheck').checked) {
                    alert('ì•½ê´€ ë™ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                    return;
                }

                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i data-lucide="loader-2" class="animate-spin w-5 h-5"></i> ì²˜ë¦¬ ì¤‘...';
                lucide.createIcons();

                // ì„œë²„ DTO êµ¬ì¡°ì™€ í•„ë“œëª… ë§ì¶¤
                const formData = {
                    userId: idInput.value,
                    userName: document.getElementById('userName').value,
                    userPw: pwInput.value,
                    userEmail: document.getElementById('userEmail').value
                };

                try {
                    const response = await fetch('/api/member/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json' // ì˜¤íƒ€ ìˆ˜ì • ì™„ë£Œ
                        },
                        body: JSON.stringify(formData)
                    });

                    if (response.ok) {
                        const msg = await response.text();
                        alert('ğŸ‰ ' + msg);
                        window.location.href = '/login';
                    } else {
                        const errorMsg = await response.text();
                        alert('ê°€ì… ì‹¤íŒ¨: ' + errorMsg);
                        resetBtn();
                    }
                } catch (e) {
                    console.error(e);
                    alert('ê°€ì… ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    resetBtn();
                }
            });

            // ë²„íŠ¼ ë³µêµ¬ìš© ê³µí†µ í•¨ìˆ˜
            function resetBtn() {
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'ê°€ì…í•˜ê¸° <i data-lucide="check" class="w-5 h-5"></i>';
                lucide.createIcons();
            }

</script>
<script type="module" src="/index.tsx"></script>
</body>
</html>