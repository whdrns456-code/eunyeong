
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>요양원 실속 비용 계산기</title>
    <!-- Tailwind CSS & Lucide Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/header.css}">

    <style>
        body { font-family: 'Pretendard', sans-serif; }

        /* 테이블 행 확장 및 강조 효과 */
        .cost-row {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 1;
        }
        .cost-row:hover {
            transform: scaleX(1.02) scaleY(1.03);
            z-index: 10;
            box-shadow: 0 15px 30px -10px rgba(59, 130, 246, 0.2);
        }

        /* 버튼 기본 스타일 (미선택 시 통일) */
        .select-btn {
            border-color: #e5e7eb; /* gray-200 */
            color: #9ca3af; /* gray-400 */
            background-color: #ffffff;
        }

        /* 등급 버튼 활성화 */
        .grade-btn.active {
            border-color: #2563eb !important; /* blue-600 */
            color: #1d4ed8 !important;
            background-color: #eff6ff !important;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.1);
        }

        /* 부담율 버튼 활성화 */
        .copay-btn.active {
            border-color: #4f46e5 !important; /* indigo-600 */
            color: #4338ca !important;
            background-color: #f5f3ff !important;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.1);
        }

        .selected-row td {
            background-color: #eff6ff !important;
            border-top-color: #2563eb !important;
            border-bottom-color: #2563eb !important;
        }
        .selected-row td:first-child { border-left-color: #2563eb !important; }
        .selected-row td:last-child { border-right-color: #2563eb !important; }
    </style>
    <script type="importmap">
        {
          "imports": {
            "@google/genai": "https://esm.sh/@google/genai@^1.40.0",
            "react": "https://esm.sh/react@^19.2.4",
            "react/": "https://esm.sh/react@^19.2.4/",
            "lucide-react": "https://esm.sh/lucide-react@^0.563.0"
          }
        }
    </script>
    <link rel="stylesheet" href="/index.css">
</head>

<body class="bg-slate-50 text-gray-900 antialiased">
<header th:replace="~{header/header :: mainHeader}"></header>
<!-- Header -->
<section class="bg-white border-b border-gray-100 sticky top-0 z-50 shadow-sm">
    <div class="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">

    </div>
</section>

<main class="max-w-6xl mx-auto px-4 py-12">
    <!-- Hero Section -->
    <section class="text-center space-y-4 mb-16">
        <h2 class="text-3xl md:text-5xl font-extrabold text-gray-900 tracking-tight leading-tight">
            어르신 요양원 비용<br/>
            <span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600 italic pr-2">30일 기준 자동 계산</span>
        </h2>
        <p class="text-gray-500 max-w-xl mx-auto text-base md:text-lg">
            2024년 최신 건강보험 수가와<br/>
            표준 식비(일 10,500원)를 반영한 월 예상 합계입니다.
        </p>
    </section>

    <!-- Summary Cards -->
    <section id="calculator-section" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
        <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 flex items-center space-x-4">
            <div class="p-3 bg-blue-50 rounded-2xl text-blue-600">
                <i data-lucide="credit-card"></i>
            </div>
            <div>
                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">급여 본인부담금 (30일)</p>
                <p id="display-copay" class="text-2xl font-black text-gray-800">₩0</p>
            </div>
        </div>
        <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 flex items-center space-x-4">
            <div class="p-3 bg-indigo-50 rounded-2xl text-indigo-600">
                <i data-lucide="utensils"></i>
            </div>
            <div>
                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">고정 식비 합계 (90끼)</p>
                <p id="display-meal" class="text-2xl font-black text-gray-800">₩315,000</p>
            </div>
        </div>
        <div class="bg-blue-600 p-6 rounded-3xl shadow-xl border border-blue-500 flex items-center space-x-4 text-white transform transition hover:scale-[1.02]">
            <div class="p-3 bg-white/20 rounded-2xl text-white">
                <i data-lucide="trending-up"></i>
            </div>
            <div>
                <p class="text-xs font-bold text-blue-100 uppercase tracking-wider">총 예상 월 지불액</p>
                <p id="display-total" class="text-2xl font-black">₩0</p>
            </div>
        </div>
    </section>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Controls -->
        <aside class="space-y-6">
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100 space-y-8">
                <div class="flex items-center gap-2 border-b border-gray-50 pb-4">
                    <i data-lucide="settings" class="text-blue-600 w-5 h-5"></i>
                    <h3 class="font-bold text-lg">조건 선택</h3>
                </div>

                <div class="space-y-3">
                    <label class="text-sm font-bold text-gray-700">장기요양 등급</label>
                    <div class="grid grid-cols-2 gap-2" id="grade-selector">
                        <button onclick="updateGrade('1등급')" class="grade-btn select-btn py-3 rounded-xl border-2 font-bold text-sm transition-all" data-grade="1등급">1등급</button>
                        <button onclick="updateGrade('2등급')" class="grade-btn select-btn py-3 rounded-xl border-2 font-bold text-sm transition-all" data-grade="2등급">2등급</button>
                        <button onclick="updateGrade('3등급')" class="grade-btn select-btn py-3 rounded-xl border-2 font-bold text-sm transition-all" data-grade="3등급">3등급</button>
                        <button onclick="updateGrade('4등급')" class="grade-btn select-btn py-3 rounded-xl border-2 font-bold text-sm transition-all" data-grade="4등급">4등급</button>
                    </div>
                </div>

                <div class="space-y-3">
                    <label class="text-sm font-bold text-gray-700">본인부담율</label>
                    <div class="grid grid-cols-2 gap-2" id="copay-selector">
                        <button onclick="updateCopay(0.2)" class="copay-btn select-btn py-2 rounded-lg border-2 font-bold text-xs transition-all" data-rate="0.2">일반 (20%)</button>
                        <button onclick="updateCopay(0.12)" class="copay-btn select-btn py-2 rounded-lg border-2 font-bold text-xs transition-all" data-rate="0.12">감경 (12%)</button>
                        <button onclick="updateCopay(0.08)" class="copay-btn select-btn py-2 rounded-lg border-2 font-bold text-xs transition-all" data-rate="0.08">감경 (8%)</button>
                        <button onclick="updateCopay(0)" class="copay-btn select-btn py-2 rounded-lg border-2 font-bold text-xs transition-all" data-rate="0">기초수급 (0%)</button>
                    </div>
                </div>

                <div class="pt-4 border-t border-gray-50 space-y-4">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                        <span class="text-xs font-bold text-gray-500">기준 일수</span>
                        <span class="text-sm font-black text-gray-900">30일 고정</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                        <span class="text-xs font-bold text-gray-500">일일 식비</span>
                        <span class="text-sm font-black text-gray-900">10,500원 (3,500원 × 3끼)</span>
                    </div>
                </div>
            </div>

            <!-- AI Advice Box -->

        </aside>

        <!-- Table Section -->
        <section id="table-section" class="lg:col-span-2">
            <div class="bg-white rounded-[2rem] shadow-sm border border-gray-100 overflow-hidden">
                <div class="p-8 border-b border-gray-50 flex items-center justify-between">
                    <div>
                        <h3 class="font-black text-2xl text-gray-900 tracking-tight">등급별 1일 비용 상세</h3>
                        <p class="text-sm text-gray-400 mt-1 italic">원하시는 등급의 행을 클릭하여 선택하세요.</p>
                    </div>
                    <span class="px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-[10px] font-black tracking-widest border border-blue-100 uppercase">2026 Standard</span>
                </div>

                <div class="p-6">
                    <table class="w-full border-separate border-spacing-y-3">
                        <thead>
                        <tr class="text-gray-400 text-[10px] font-black uppercase tracking-widest text-left">
                            <th class="px-6 py-2">등급명</th>
                            <th class="px-6 py-2 text-center">1일 총액</th>
                            <th class="px-6 py-2 text-center text-blue-600">일반(20%)</th>
                            <th class="px-6 py-2 text-center">감경(12%)</th>
                            <th class="px-6 py-2 text-center">감경(8%)</th>
                        </tr>
                        </thead>
                        <tbody id="rate-table-body">
                        <!-- JS Dynamic Injection -->
                        </tbody>
                    </table>
                </div>

                <!-- Selected Info Detail -->
                <div id="detail-box" class="m-8 p-6 bg-blue-50/50 rounded-2xl border border-blue-100 flex gap-4 transition-all duration-300">
                    <div class="p-2 bg-white rounded-xl shadow-sm self-start text-blue-600">
                        <i data-lucide="info" class="w-5 h-5"></i>
                    </div>
                    <div class="space-y-1">
                        <p class="text-sm font-black text-blue-900 tracking-tight"><span id="detail-grade-name">1등급</span> 판정 기준</p>
                        <p id="detail-grade-desc" class="text-xs text-blue-700/80 leading-relaxed font-medium"></p>
                    </div>
                </div>
            </div>
        </section>
    </div>
</main>

<footer class="mt-20 py-12 bg-white border-t border-gray-100 text-center">
    <p class="text-xs text-gray-400 max-w-sm mx-auto leading-relaxed font-medium">
        © 2024 Smart Care Explorer. 본 계산 결과는 법적 효력이 없으며 정확한 비용은 시설 상담을 통해 확인 바랍니다.
    </p>
</footer>

<script type="module">
    import { GoogleGenAI } from "@google/genai";

    const DAILY_RATES = [
        { grade: '1등급', fullCost: 93070, s20: 18610, s12: 11160, s8: 7440, desc: "심신의 기능상태 장애로 일상생활에서 전적으로 다른 사람의 도움이 필요한 자" },
        { grade: '2등급', fullCost: 86340, s20: 17260, s12: 10260, s8: 6900, desc: "심신의 기능상태 장애로 일상생활에서 상당 부분 다른 사람의 도움이 필요한 자" },
        { grade: '3등급', fullCost: 81540, s20: 16300, s12: 9780, s8: 6520, desc: "심신의 기능상태 장애로 일상생활에서 부분적으로 다른 사람의 도움이 필요한 자" },
        { grade: '4등급', fullCost: 81540, s20: 16300, s12: 9780, s8: 6520, desc: "심신의 기능상태 장애로 일상생활에서 일정 부분 다른 사람의 도움이 필요한 자" }
    ];

    let state = {
        grade: '1등급',
        copayRate: 0.2,
        days: 30,
        mealDaily: 10500 // 3,500원 * 3끼
    };

    window.updateGrade = (grade) => {
        state.grade = grade;

        // 버튼 스타일 갱신
        document.querySelectorAll('.grade-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.grade === grade);
        });

        const data = DAILY_RATES.find(r => r.grade === grade);
        document.getElementById('detail-grade-name').innerText = grade;
        document.getElementById('detail-grade-desc').innerText = data.desc;

        renderTable();
        calculate();
    };

    window.updateCopay = (rate) => {
        state.copayRate = rate;

        // 버튼 스타일 갱신
        document.querySelectorAll('.copay-btn').forEach(btn => {
            btn.classList.toggle('active', parseFloat(btn.dataset.rate) === rate);
        });

        calculate();
    };

    window.calculate = () => {
        const rateData = DAILY_RATES.find(r => r.grade === state.grade);
        const copayAmount = rateData.fullCost * state.days * state.copayRate;
        const mealAmount = state.mealDaily * state.days;

        document.getElementById('display-copay').innerText = `₩${Math.round(copayAmount).toLocaleString()}`;
        document.getElementById('display-meal').innerText = `₩${Math.round(mealAmount).toLocaleString()}`;
        document.getElementById('display-total').innerText = `₩${Math.round(copayAmount + mealAmount).toLocaleString()}`;
    };

    window.fetchAIAdvice = async () => {
        const btn = document.getElementById('ai-btn');
        const resBox = document.getElementById('ai-response');
        btn.disabled = true;
        btn.innerText = "분석 중...";

        try {
            const ai = new GoogleGenAI({ apiKey: 'API_KEY' });
            const prompt = `노인장기요양보험 ${state.grade} 어르신, 본인부담율 ${(state.copayRate*100)}% 기준, 한 달 약 30일 이용 시의 경제적 조언과 감경 혜택 정보를 친절하게 요약해줘.`;
            const response = await ai.models.generateContent({
                model: 'gemini-3-flash-preview',
                contents: prompt
            });
            resBox.innerText = response.text;
            resBox.classList.remove('hidden');
        } catch (e) {
            resBox.innerText = "상담 정보를 불러오지 못했습니다.";
            resBox.classList.remove('hidden');
        } finally {
            btn.disabled = false;
            btn.innerText = "가이드 확인하기";
        }
    };

    function renderTable() {
        const tbody = document.getElementById('rate-table-body');
        tbody.innerHTML = DAILY_RATES.map(rate => {
            const isSelected = state.grade === rate.grade;
            return `
                <tr onclick="updateGrade('${rate.grade}')" class="cost-row group cursor-pointer relative ${isSelected ? 'selected-row' : ''}">
                    <td class="px-6 py-5 rounded-l-2xl bg-white border-y border-l border-gray-100 transition-all duration-200">
                        <div class="flex items-center gap-3">
                            <span class="w-8 h-8 rounded-full flex items-center justify-center font-black text-[10px] ${isSelected ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-400 group-hover:bg-blue-200 group-hover:text-blue-600'}">
                                ${rate.grade.replace('등급','')}
                            </span>
                            <span class="font-bold ${isSelected ? 'text-blue-700' : 'text-gray-800'}">${rate.grade}</span>
                        </div>
                    </td>
                    <td class="px-6 py-5 text-center bg-white border-y border-gray-100 font-bold ${isSelected ? 'text-blue-700' : 'text-gray-900'} transition-all">${rate.fullCost.toLocaleString()}</td>
                    <td class="px-6 py-5 text-center bg-white border-y border-gray-100 font-black text-blue-600 transition-all">${rate.s20.toLocaleString()}</td>
                    <td class="px-6 py-5 text-center bg-white border-y border-gray-100 font-medium ${isSelected ? 'text-blue-500' : 'text-gray-400'} transition-all">${rate.s12.toLocaleString()}</td>
                    <td class="px-6 py-5 text-center bg-white border-y border-r border-gray-100 rounded-r-2xl font-medium ${isSelected ? 'text-blue-500' : 'text-gray-400'} transition-all">${rate.s8.toLocaleString()}</td>
                </tr>
            `}).join('');
    }

    // Init
    lucide.createIcons();
    updateGrade('1등급');
    updateCopay(0.2);
</script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
